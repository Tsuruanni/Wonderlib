          "content": "import 'package:flutter/material.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\nimport 'package:go_router/go_router.dart';\n\nimport '../../../core/supabase_client.dart';\n\n/// Provider for school filter\nfinal schoolFilterProvider = StateProvider<String?>((ref) => null);\n\n/// Provider for role filter\nfinal roleFilterProvider = StateProvider<String?>((ref) => null);\n\n/// Provider for loading all users with filters\nfinal usersProvider = FutureProvider<List<Map<String, dynamic>>>((ref) async {\n  final supabase = ref.watch(supabaseClientProvider);\n  final schoolFilter = ref.watch(schoolFilterProvider);\n  final roleFilter = ref.watch(roleFilterProvider);\n\n  var query = supabase\n      .from('profiles')\n      .select('*, schools(name)')\n      .order('created_at', ascending: false);\n\n  if (schoolFilter != null) {\n    query = query.eq('school_id', schoolFilter);\n  }\n  if (roleFilter != null) {\n    query = query.eq('role', roleFilter);\n  }\n\n  final response = await query;\n  return List<Map<String, dynamic>>.from(response);\n});\n\n/// Provider for loading all schools (for filter dropdown)\nfinal allSchoolsProvider = FutureProvider<List<Map<String, dynamic>>>((ref) async {\n  final supabase = ref.watch(supabaseClientProvider);\n  final response = await supabase\n      .from('schools')\n      .select('id, name')\n      .order('name');\n  return List<Map<String, dynamic>>.from(response);\n});\n\nclass UserListScreen extends ConsumerWidget {\n  const UserListScreen({super.key});\n\n  @override\n  Widget build(BuildContext context, WidgetRef ref) {\n    final usersAsync = ref.watch(usersProvider);\n    final schoolsAsync = ref.watch(allSchoolsProvider);\n    final selectedSchool = ref.watch(schoolFilterProvider);\n    final selectedRole = ref.watch(roleFilterProvider);\n\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Users'),\n        leading: IconButton(\n          icon: const Icon(Icons.arrow_back),\n          onPressed: () => context.go('/'),\n        ),\n      ),\n      body: Column(\n        children: [\n          // Filters\n          Container(\n            padding: const EdgeInsets.all(16),\n            decoration: BoxDecoration(\n              color: Colors.grey.shade50,\n              border: Border(\n                bottom: BorderSide(color: Colors.grey.shade200),\n              ),\n            ),\n            child: Row(\n              children: [\n                // School filter\n                Expanded(\n                  child: schoolsAsync.when(\n                    data: (schools) => DropdownButtonFormField<String?>(\n                      value: selectedSchool,\n                      decoration: const InputDecoration(\n                        labelText: 'School',\n                        contentPadding: EdgeInsets.symmetric(horizontal: 12, vertical: 8),\n                        border: OutlineInputBorder(),\n                      ),\n                      items: [\n                        const DropdownMenuItem(\n                          value: null,\n                          child: Text('All Schools'),\n                        ),\n                        ...schools.map((school) => DropdownMenuItem(\n                              value: school['id'] as String,\n                              child: Text(school['name'] as String),\n                            )),\n                      ],\n                      onChanged: (value) {\n                        ref.read(schoolFilterProvider.notifier).state = value;\n                      },\n                    ),\n                    loading: () => const SizedBox.shrink(),\n                    error: (_, __) => const SizedBox.shrink(),\n                  ),\n                ),\n                const SizedBox(width: 16),\n\n                // Role filter\n                Expanded(\n                  child: DropdownButtonFormField<String?>(\n                    value: selectedRole,\n                    decoration: const InputDecoration(\n                      labelText: 'Role',\n                      contentPadding: EdgeInsets.symmetric(horizontal: 12, vertical: 8),\n                      border: OutlineInputBorder(),\n                    ),\n                    items: const [\n                      DropdownMenuItem(value: null, child: Text('All Roles')),\n                      DropdownMenuItem(value: 'student', child: Text('Student')),\n                      DropdownMenuItem(value: 'teacher', child: Text('Teacher')),\n                      DropdownMenuItem(value: 'head', child: Text('Head Teacher')),\n                      DropdownMenuItem(value: 'admin', child: Text('Admin')),\n                    ],\n                    onChanged: (value) {\n                      ref.read(roleFilterProvider.notifier).state = value;\n                    },\n                  ),\n                ),\n                const SizedBox(width: 16),\n\n                // Clear filters\n                if (selectedSchool != null || selectedRole != null)\n                  TextButton.icon(\n                    onPressed: () {\n                      ref.read(schoolFilterProvider.notifier).state = null;\n                      ref.read(roleFilterProvider.notifier).state = null;\n                    },\n                    icon: const Icon(Icons.clear, size: 18),\n                    label: const Text('Clear'),\n                  ),\n              ],\n            ),\n          ),\n\n          // Users list\n          Expanded(\n            child: usersAsync.when(\n              data: (users) {\n                if (users.isEmpty) {\n                  return Center(\n                    child: Column(\n                      mainAxisAlignment: MainAxisAlignment.center,\n                      children: [\n                        Icon(\n                          Icons.people_outline,\n                          size: 64,\n                          color: Colors.grey.shade400,\n                        ),\n                        const SizedBox(height: 16),\n                        Text(\n                          'No users found',\n                          style: TextStyle(\n                            fontSize: 18,\n                            color: Colors.grey.shade600,\n                          ),\n                        ),\n                        const SizedBox(height: 8),\n                        Text(\n                          'Create users via Supabase Dashboard',\n                          style: TextStyle(\n                            fontSize: 14,\n                            color: Colors.grey.shade500,\n                          ),\n                        ),\n                      ],\n                    ),\n                  );\n                }\n\n                return ListView.builder(\n                  padding: const EdgeInsets.all(24),\n                  itemCount: users.length,\n                  itemBuilder: (context, index) {\n                    final user = users[index];\n                    return _UserCard(\n                      user: user,\n                      onTap: () => context.go('/users/${user['id']}'),\n                    );\n                  },\n                );\n              },\n              loading: () => const Center(child: CircularProgressIndicator()),\n              error: (error, _) => Center(\n                child: Column(\n                  mainAxisAlignment: MainAxisAlignment.center,\n                  children: [\n                    Icon(Icons.error_outline, size: 48, color: Colors.red.shade400),\n                    const SizedBox(height: 16),\n                    Text('Error: $error'),\n                    const SizedBox(height: 16),\n                    FilledButton(\n                      onPressed: () => ref.invalidate(usersProvider),\n                      child: const Text('Retry'),\n                    ),\n                  ],\n                ),\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n}\n\nclass _UserCard extends StatelessWidget {\n  const _UserCard({\n    required this.user,\n    required this.onTap,\n  });\n\n  final Map<String, dynamic> user;\n  final VoidCallback onTap;\n\n  @override\n  Widget build(BuildContext context) {\n    final firstName = user['first_name'] as String? ?? '';\n    final lastName = user['last_name'] as String? ?? '';\n    final email = user['email'] as String? ?? '';\n    final role = user['role'] as String? ?? 'student';\n    final schoolName = user['schools']?['name'] as String?;\n    final xp = user['xp'] as int? ?? 0;\n    final level = user['level'] as int? ?? 1;\n\n    final fullName = '$firstName $lastName'.trim();\n    final displayName = fullName.isNotEmpty ? fullName : email;\n\n    return Card(\n      margin: const EdgeInsets.only(bottom: 12),\n      clipBehavior: Clip.antiAlias,\n      child: InkWell(\n        onTap: onTap,\n        child: Padding(\n          padding: const EdgeInsets.all(16),\n          child: Row(\n            children: [\n              // Avatar\n              CircleAvatar(\n                radius: 24,\n                backgroundColor: _getRoleColor(role).withValues(alpha: 0.1),\n                child: Text(\n                  _getInitials(firstName, lastName, email),\n                  style: TextStyle(\n                    color: _getRoleColor(role),\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n              ),\n              const SizedBox(width: 16),\n\n              // User info\n              Expanded(\n                child: Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    // Name\n                    Text(\n                      displayName,\n                      style: const TextStyle(\n                        fontSize: 16,\n                        fontWeight: FontWeight.bold,\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n                    const SizedBox(height: 4),\n\n                    // Email\n                    if (fullName.isNotEmpty)\n                      Text(\n                        email,\n                        style: TextStyle(\n                          fontSize: 14,\n                          color: Colors.grey.shade600,\n                        ),\n                      ),\n                    const SizedBox(height: 8),\n\n                    // Chips\n                    Wrap(\n                      spacing: 8,\n                      runSpacing: 4,\n                      children: [\n                        _Chip(\n                          label: _getRoleLabel(role),\n                          color: _getRoleColor(role),\n                        ),\n                        if (schoolName != null)\n                          _Chip(\n                            label: schoolName,\n                            color: Colors.grey,\n                          ),\n                        _Chip(\n                          label: 'Lv.$level ($xp XP)',\n                          color: Colors.purple,\n                        ),\n                      ],\n                    ),\n                  ],\n                ),\n              ),\n\n              // Arrow\n              Icon(\n                Icons.chevron_right,\n                color: Colors.grey.shade400,\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  String _getInitials(String firstName, String lastName, String email) {\n    if (firstName.isNotEmpty && lastName.isNotEmpty) {\n      return '${firstName[0]}${lastName[0]}'.toUpperCase();\n    }\n    if (firstName.isNotEmpty) {\n      return firstName[0].toUpperCase();\n    }\n    if (email.isNotEmpty) {\n      return email[0].toUpperCase();\n    }\n    return '?';\n  }\n\n  Color _getRoleColor(String role) {\n    switch (role.toLowerCase()) {\n      case 'admin':\n        return Colors.red;\n      case 'head':\n        return Colors.purple;\n      case 'teacher':\n        return Colors.blue;\n      case 'student':\n        return Colors.green;\n      default:\n        return Colors.grey;\n    }\n  }\n\n  String _getRoleLabel(String role) {\n    switch (role.toLowerCase()) {\n      case 'admin':\n        return 'Admin';\n      case 'head':\n        return 'Head Teacher';\n      case 'teacher':\n        return 'Teacher';\n      case 'student':\n        return 'Student';\n      default:\n        return role;\n    }\n  }\n}\n\nclass _Chip extends StatelessWidget {\n  const _Chip({\n    required this.label,\n    required this.color,\n  });\n\n  final String label;\n  final Color color;\n\n  @override\n  Widget build(BuildContext context) {\n    return Container(\n      padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n      decoration: BoxDecoration(\n        color: color.withValues(alpha: 0.1),\n        borderRadius: BorderRadius.circular(4),\n      ),\n      child: Text(\n        label,\n        style: TextStyle(\n          fontSize: 12,\n          color: color,\n          fontWeight: FontWeight.w500,\n        ),\n      ),\n    );\n  }\n}\n"
        },
        "caller": {
          "type": "direct"
        }
      }
    ]
  },
  {
    "role": "user",
    "content": [
      {
        "tool_use_id": "toolu_018qcBSJpn9USxJZ2PNnnQ7A",
        "type": "tool_result",
        "content": "File created successfully at: /Users/wonderelt/Desktop/readeng_admin/lib/features/users/screens/user_list_screen.dart"
      }
    ]
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool_use",
        "id": "toolu_01Y2orTK63avU9LaUwr6rDKm",
        "name": "Write",
        "input": {
          "file_path": "/Users/wonderelt/Desktop/readeng_admin/lib/features/users/screens/user_edit_screen.dart",
