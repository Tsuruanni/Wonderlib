        "content": "     1→import 'package:flutter/material.dart';\n     2→import 'package:flutter_riverpod/flutter_riverpod.dart';\n     3→import 'package:go_router/go_router.dart';\n     4→import 'package:intl/intl.dart';\n     5→\n     6→import '../../../../core/utils/extensions/context_extensions.dart';\n     7→import '../../../../domain/repositories/teacher_repository.dart';\n     8→import '../../../providers/teacher_provider.dart';\n     9→\n    10→class AssignmentReportScreen extends ConsumerWidget {\n    11→  const AssignmentReportScreen({super.key});\n    12→\n    13→  @override\n    14→  Widget build(BuildContext context, WidgetRef ref) {\n    15→    final assignmentsAsync = ref.watch(teacherAssignmentsProvider);\n    16→\n    17→    return Scaffold(\n    18→      appBar: AppBar(\n    19→        title: const Text('Assignment Performance'),\n    20→      ),\n    21→      body: RefreshIndicator(\n    22→        onRefresh: () async {\n    23→          ref.invalidate(teacherAssignmentsProvider);\n    24→        },\n    25→        child: assignmentsAsync.when(\n    26→          loading: () => const Center(child: CircularProgressIndicator()),\n    27→          error: (error, _) => Center(\n    28→            child: Column(\n    29→              mainAxisAlignment: MainAxisAlignment.center,\n    30→              children: [\n    31→                Icon(Icons.error_outline, size: 48, color: context.colorScheme.error),\n    32→                const SizedBox(height: 16),\n    33→                Text('Error loading data', style: context.textTheme.bodyLarge),\n    34→                const SizedBox(height: 8),\n    35→                TextButton(\n    36→                  onPressed: () => ref.invalidate(teacherAssignmentsProvider),\n    37→                  child: const Text('Retry'),\n    38→                ),\n    39→              ],\n    40→            ),\n    41→          ),\n    42→          data: (assignments) {\n    43→            if (assignments.isEmpty) {\n    44→              return Center(\n    45→                child: Column(\n    46→                  mainAxisAlignment: MainAxisAlignment.center,\n    47→                  children: [\n    48→                    Icon(\n    49→                      Icons.assignment_outlined,\n    50→                      size: 64,\n    51→                      color: context.colorScheme.outline,\n    52→                    ),\n    53→                    const SizedBox(height: 16),\n    54→                    Text(\n    55→                      'No assignments yet',\n    56→                      style: context.textTheme.titleMedium,\n    57→                    ),\n    58→                  ],\n    59→                ),\n    60→              );\n    61→            }\n    62→\n    63→            // Calculate overall stats\n    64→            final totalAssignments = assignments.length;\n    65→            final totalStudents = assignments.fold<int>(0, (sum, a) => sum + a.totalStudents);\n    66→            final totalCompleted = assignments.fold<int>(0, (sum, a) => sum + a.completedStudents);\n    67→            final avgCompletionRate = totalStudents > 0\n    68→                ? (totalCompleted / totalStudents) * 100\n    69→                : 0.0;\n    70→\n    71→            return ListView(\n    72→              padding: const EdgeInsets.all(16),\n    73→              children: [\n    74→                // Overall stats\n    75→                Card(\n    76→                  color: context.colorScheme.primaryContainer,\n    77→                  child: Padding(\n    78→                    padding: const EdgeInsets.all(16),\n    79→                    child: Column(\n    80→                      children: [\n    81→                        Text(\n    82→                          'Overall Performance',\n    83→                          style: context.textTheme.titleSmall?.copyWith(\n    84→                            color: context.colorScheme.onPrimaryContainer,\n    85→                          ),\n    86→                        ),\n    87→                        const SizedBox(height: 12),\n    88→                        Row(\n    89→                          mainAxisAlignment: MainAxisAlignment.spaceAround,\n    90→                          children: [\n    91→                            _StatItem(\n    92→                              value: '$totalAssignments',\n    93→                              label: 'Assignments',\n    94→                            ),\n    95→                            _StatItem(\n    96→                              value: '$totalCompleted/$totalStudents',\n    97→                              label: 'Completed',\n    98→                            ),\n    99→                            _StatItem(\n   100→                              value: '${avgCompletionRate.toStringAsFixed(0)}%',\n   101→                              label: 'Avg Rate',\n   102→                            ),\n   103→                          ],\n   104→                        ),\n   105→                      ],\n   106→                    ),\n   107→                  ),\n   108→                ),\n   109→\n   110→                const SizedBox(height: 24),\n   111→\n   112→                Text(\n   113→                  'Assignment Details',\n   114→                  style: context.textTheme.titleMedium?.copyWith(\n   115→                    fontWeight: FontWeight.bold,\n   116→                  ),\n   117→                ),\n   118→                const SizedBox(height: 12),\n   119→\n   120→                // Assignment cards\n   121→                ...assignments.map((assignment) => _AssignmentReportCard(\n   122→                  assignment: assignment,\n   123→                  onTap: () => context.push('/teacher/assignments/${assignment.id}'),\n   124→                )),\n   125→              ],\n   126→            );\n   127→          },\n   128→        ),\n   129→      ),\n   130→    );\n   131→  }\n   132→}\n   133→\n   134→class _StatItem extends StatelessWidget {\n   135→  const _StatItem({\n   136→    required this.value,\n   137→    required this.label,\n   138→  });\n   139→\n   140→  final String value;\n   141→  final String label;\n   142→\n   143→  @override\n   144→  Widget build(BuildContext context) {\n   145→    return Column(\n   146→      children: [\n   147→        Text(\n   148→          value,\n   149→          style: context.textTheme.headlineSmall?.copyWith(\n   150→            fontWeight: FontWeight.bold,\n   151→            color: context.colorScheme.onPrimaryContainer,\n   152→          ),\n   153→        ),\n   154→        Text(\n   155→          label,\n   156→          style: context.textTheme.bodySmall?.copyWith(\n   157→            color: context.colorScheme.onPrimaryContainer.withValues(alpha: 0.7),\n   158→          ),\n   159→        ),\n   160→      ],\n   161→    );\n   162→  }\n   163→}\n   164→\n   165→class _AssignmentReportCard extends StatelessWidget {\n   166→  const _AssignmentReportCard({\n   167→    required this.assignment,\n   168→    required this.onTap,\n   169→  });\n   170→\n   171→  final Assignment assignment;\n   172→  final VoidCallback onTap;\n   173→\n   174→  @override\n   175→  Widget build(BuildContext context) {\n   176→    final dateFormat = DateFormat('MMM d');\n   177→\n   178→    return Card(\n   179→      margin: const EdgeInsets.only(bottom: 8),\n   180→      child: InkWell(\n   181→        onTap: onTap,\n   182→        borderRadius: BorderRadius.circular(12),\n   183→        child: Padding(\n   184→          padding: const EdgeInsets.all(16),\n   185→          child: Column(\n   186→            crossAxisAlignment: CrossAxisAlignment.start,\n   187→            children: [\n   188→              Row(\n   189→                children: [\n   190→                  // Type icon\n   191→                  Container(\n   192→                    padding: const EdgeInsets.all(8),\n   193→                    decoration: BoxDecoration(\n   194→                      color: _getTypeColor(assignment.type).withValues(alpha: 0.1),\n   195→                      borderRadius: BorderRadius.circular(8),\n   196→                    ),\n   197→                    child: Icon(\n   198→                      _getTypeIcon(assignment.type),\n   199→                      color: _getTypeColor(assignment.type),\n   200→                      size: 20,\n   201→                    ),\n   202→                  ),\n   203→                  const SizedBox(width: 12),\n   204→\n   205→                  // Title\n   206→                  Expanded(\n   207→                    child: Column(\n   208→                      crossAxisAlignment: CrossAxisAlignment.start,\n   209→                      children: [\n   210→                        Text(\n   211→                          assignment.title,\n   212→                          style: context.textTheme.titleSmall?.copyWith(\n   213→                            fontWeight: FontWeight.bold,\n   214→                          ),\n   215→                          maxLines: 1,\n   216→                          overflow: TextOverflow.ellipsis,\n   217→                        ),\n   218→                        if (assignment.className != null)\n   219→                          Text(\n   220→                            assignment.className!,\n   221→                            style: context.textTheme.bodySmall?.copyWith(\n   222→                              color: context.colorScheme.outline,\n   223→                            ),\n   224→                          ),\n   225→                      ],\n   226→                    ),\n   227→                  ),\n   228→\n   229→                  // Status badge\n   230→                  _StatusBadge(assignment: assignment),\n   231→                ],\n   232→              ),\n   233→\n   234→              const SizedBox(height: 12),\n   235→\n   236→              // Progress section\n   237→              Row(\n   238→                children: [\n   239→                  // Completion stats\n   240→                  Expanded(\n   241→                    flex: 2,\n   242→                    child: Column(\n   243→                      crossAxisAlignment: CrossAxisAlignment.start,\n   244→                      children: [\n   245→                        Row(\n   246→                          children: [\n   247→                            Text(\n   248→                              '${assignment.completedStudents}',\n   249→                              style: context.textTheme.titleLarge?.copyWith(\n   250→                                fontWeight: FontWeight.bold,\n   251→                                color: Colors.green,\n   252→                              ),\n   253→                            ),\n   254→                            Text(\n   255→                              ' / ${assignment.totalStudents}',\n   256→                              style: context.textTheme.titleMedium?.copyWith(\n   257→                                color: context.colorScheme.outline,\n   258→                              ),\n   259→                            ),\n   260→                            Text(\n   261→                              ' completed',\n   262→                              style: context.textTheme.bodySmall?.copyWith(\n   263→                                color: context.colorScheme.outline,\n   264→                              ),\n   265→                            ),\n   266→                          ],\n   267→                        ),\n   268→                        const SizedBox(height: 4),\n   269→                        ClipRRect(\n   270→                          borderRadius: BorderRadius.circular(4),\n   271→                          child: LinearProgressIndicator(\n   272→                            value: assignment.completionRate / 100,\n   273→                            backgroundColor: context.colorScheme.surfaceContainerHighest,\n   274→                            color: _getCompletionColor(assignment.completionRate),\n   275→                            minHeight: 8,\n   276→                          ),\n   277→                        ),\n   278→                      ],\n   279→                    ),\n   280→                  ),\n   281→\n   282→                  const SizedBox(width: 16),\n   283→\n   284→                  // Completion percentage\n   285→                  Container(\n   286→                    padding: const EdgeInsets.all(12),\n   287→                    decoration: BoxDecoration(\n   288→                      color: _getCompletionColor(assignment.completionRate).withValues(alpha: 0.1),\n   289→                      borderRadius: BorderRadius.circular(8),\n   290→                    ),\n   291→                    child: Text(\n   292→                      '${assignment.completionRate.toStringAsFixed(0)}%',\n   293→                      style: context.textTheme.titleMedium?.copyWith(\n   294→                        fontWeight: FontWeight.bold,\n   295→                        color: _getCompletionColor(assignment.completionRate),\n   296→                      ),\n   297→                    ),\n   298→                  ),\n   299→                ],\n   300→              ),\n   301→\n   302→              const SizedBox(height: 8),\n   303→\n   304→              // Date info\n   305→              Row(\n   306→                children: [\n   307→                  Icon(\n   308→                    Icons.calendar_today,\n   309→                    size: 14,\n   310→                    color: context.colorScheme.outline,\n   311→                  ),\n   312→                  const SizedBox(width: 4),\n   313→                  Text(\n   314→                    'Due: ${dateFormat.format(assignment.dueDate)}',\n   315→                    style: context.textTheme.bodySmall?.copyWith(\n   316→                      color: assignment.isOverdue\n   317→                          ? context.colorScheme.error\n   318→                          : context.colorScheme.outline,\n   319→                    ),\n   320→                  ),\n   321→                ],\n   322→              ),\n   323→            ],\n   324→          ),\n   325→        ),\n   326→      ),\n   327→    );\n   328→  }\n   329→\n   330→  IconData _getTypeIcon(AssignmentType type) {\n   331→    switch (type) {\n   332→      case AssignmentType.book:\n   333→        return Icons.menu_book;\n   334→      case AssignmentType.vocabulary:\n   335→        return Icons.abc;\n   336→      case AssignmentType.mixed:\n   337→        return Icons.library_books;\n   338→    }\n   339→  }\n   340→\n   341→  Color _getTypeColor(AssignmentType type) {\n   342→    switch (type) {\n   343→      case AssignmentType.book:\n   344→        return Colors.blue;\n   345→      case AssignmentType.vocabulary:\n   346→        return Colors.purple;\n   347→      case AssignmentType.mixed:\n   348→        return Colors.teal;\n   349→    }\n   350→  }\n   351→\n   352→  Color _getCompletionColor(double rate) {\n   353→    if (rate >= 80) return Colors.green;\n   354→    if (rate >= 50) return Colors.orange;\n   355→    return Colors.red;\n   356→  }\n   357→}\n   358→\n   359→class _StatusBadge extends StatelessWidget {\n   360→  const _StatusBadge({required this.assignment});\n   361→\n   362→  final Assignment assignment;\n   363→\n   364→  @override\n   365→  Widget build(BuildContext context) {\n   366→    Color color;\n   367→    String text;\n   368→\n   369→    if (assignment.isOverdue) {\n   370→      color = Colors.red;\n   371→      text = 'Overdue';\n   372→    } else if (assignment.isUpcoming) {\n   373→      color = Colors.blue;\n   374→      text = 'Upcoming';\n   375→    } else {\n   376→      color = Colors.green;\n   377→      text = 'Active';\n   378→    }\n   379→\n   380→    return Container(\n   381→      padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n   382→      decoration: BoxDecoration(\n   383→        color: color.withValues(alpha: 0.1),\n   384→        borderRadius: BorderRadius.circular(12),\n   385→      ),\n   386→      child: Text(\n   387→        text,\n   388→        style: context.textTheme.labelSmall?.copyWith(\n   389→          color: color,\n   390→          fontWeight: FontWeight.w600,\n   391→        ),\n   392→      ),\n   393→    );\n   394→  }\n   395→}\n   396→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"
      }
    ]
  },
  {
    "role": "user",
    "content": [
      {
        "tool_use_id": "toolu_01L5Cb7FdA1bZFGRRtVXCqMJ",
        "type": "tool_result",
