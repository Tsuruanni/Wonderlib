        "content": "     1→import 'package:flutter/material.dart';\n     2→import 'package:flutter_riverpod/flutter_riverpod.dart';\n     3→import 'package:go_router/go_router.dart';\n     4→import 'package:intl/intl.dart';\n     5→\n     6→import '../../../core/utils/extensions/context_extensions.dart';\n     7→import '../../../domain/repositories/teacher_repository.dart';\n     8→import '../../providers/repository_providers.dart';\n     9→import '../../providers/teacher_provider.dart';\n    10→\n    11→class AssignmentDetailScreen extends ConsumerWidget {\n    12→  const AssignmentDetailScreen({\n    13→    super.key,\n    14→    required this.assignmentId,\n    15→  });\n    16→\n    17→  final String assignmentId;\n    18→\n    19→  @override\n    20→  Widget build(BuildContext context, WidgetRef ref) {\n    21→    final assignmentAsync = ref.watch(assignmentDetailProvider(assignmentId));\n    22→    final studentsAsync = ref.watch(assignmentStudentsProvider(assignmentId));\n    23→\n    24→    return Scaffold(\n    25→      body: assignmentAsync.when(\n    26→        loading: () => const Center(child: CircularProgressIndicator()),\n    27→        error: (error, _) => Center(\n    28→          child: Column(\n    29→            mainAxisAlignment: MainAxisAlignment.center,\n    30→            children: [\n    31→              Icon(Icons.error_outline, size: 48, color: context.colorScheme.error),\n    32→              const SizedBox(height: 16),\n    33→              Text('Error loading assignment', style: context.textTheme.bodyLarge),\n    34→              const SizedBox(height: 8),\n    35→              TextButton(\n    36→                onPressed: () {\n    37→                  ref.invalidate(assignmentDetailProvider(assignmentId));\n    38→                  ref.invalidate(assignmentStudentsProvider(assignmentId));\n    39→                },\n    40→                child: const Text('Retry'),\n    41→              ),\n    42→            ],\n    43→          ),\n    44→        ),\n    45→        data: (assignment) {\n    46→          if (assignment == null) {\n    47→            return const Center(child: Text('Assignment not found'));\n    48→          }\n    49→\n    50→          return CustomScrollView(\n    51→            slivers: [\n    52→              // App bar with assignment info\n    53→              _AssignmentAppBar(assignment: assignment),\n    54→\n    55→              // Stats bar\n    56→              SliverToBoxAdapter(\n    57→                child: _StatsBar(assignment: assignment),\n    58→              ),\n    59→\n    60→              // Section header\n    61→              SliverToBoxAdapter(\n    62→                child: Padding(\n    63→                  padding: const EdgeInsets.all(16),\n    64→                  child: Row(\n    65→                    children: [\n    66→                      Text(\n    67→                        'Student Progress',\n    68→                        style: context.textTheme.titleMedium?.copyWith(\n    69→                          fontWeight: FontWeight.bold,\n    70→                        ),\n    71→                      ),\n    72→                      const Spacer(),\n    73→                      TextButton.icon(\n    74→                        onPressed: () {\n    75→                          ref.invalidate(assignmentStudentsProvider(assignmentId));\n    76→                        },\n    77→                        icon: const Icon(Icons.refresh, size: 18),\n    78→                        label: const Text('Refresh'),\n    79→                      ),\n    80→                    ],\n    81→                  ),\n    82→                ),\n    83→              ),\n    84→\n    85→              // Student list\n    86→              studentsAsync.when(\n    87→                loading: () => const SliverToBoxAdapter(\n    88→                  child: Center(child: CircularProgressIndicator()),\n    89→                ),\n    90→                error: (_, __) => const SliverToBoxAdapter(\n    91→                  child: Center(child: Text('Error loading students')),\n    92→                ),\n    93→                data: (students) {\n    94→                  if (students.isEmpty) {\n    95→                    return SliverToBoxAdapter(\n    96→                      child: Container(\n    97→                        padding: const EdgeInsets.all(32),\n    98→                        child: Column(\n    99→                          children: [\n   100→                            Icon(\n   101→                              Icons.people_outline,\n   102→                              size: 48,\n   103→                              color: context.colorScheme.outline,\n   104→                            ),\n   105→                            const SizedBox(height: 12),\n   106→                            Text(\n   107→                              'No students assigned',\n   108→                              style: context.textTheme.bodyMedium?.copyWith(\n   109→                                color: context.colorScheme.outline,\n   110→                              ),\n   111→                            ),\n   112→                          ],\n   113→                        ),\n   114→                      ),\n   115→                    );\n   116→                  }\n   117→\n   118→                  return SliverList(\n   119→                    delegate: SliverChildBuilderDelegate(\n   120→                      (context, index) {\n   121→                        final student = students[index];\n   122→                        return _StudentProgressCard(student: student);\n   123→                      },\n   124→                      childCount: students.length,\n   125→                    ),\n   126→                  );\n   127→                },\n   128→              ),\n   129→\n   130→              // Bottom padding\n   131→              const SliverToBoxAdapter(\n   132→                child: SizedBox(height: 32),\n   133→              ),\n   134→            ],\n   135→          );\n   136→        },\n   137→      ),\n   138→    );\n   139→  }\n   140→}\n   141→\n   142→class _AssignmentAppBar extends StatelessWidget {\n   143→  const _AssignmentAppBar({required this.assignment});\n   144→\n   145→  final Assignment assignment;\n   146→\n   147→  @override\n   148→  Widget build(BuildContext context) {\n   149→    final dateFormat = DateFormat('MMM d, y');\n   150→\n   151→    return SliverAppBar(\n   152→      expandedHeight: 180,\n   153→      pinned: true,\n   154→      actions: [\n   155→        PopupMenuButton<String>(\n   156→          onSelected: (value) async {\n   157→            if (value == 'delete') {\n   158→              final confirmed = await showDialog<bool>(\n   159→                context: context,\n   160→                builder: (context) => AlertDialog(\n   161→                  title: const Text('Delete Assignment?'),\n   162→                  content: const Text(\n   163→                    'This will permanently delete the assignment and all student progress. This action cannot be undone.',\n   164→                  ),\n   165→                  actions: [\n   166→                    TextButton(\n   167→                      onPressed: () => Navigator.pop(context, false),\n   168→                      child: const Text('Cancel'),\n   169→                    ),\n   170→                    TextButton(\n   171→                      onPressed: () => Navigator.pop(context, true),\n   172→                      style: TextButton.styleFrom(\n   173→                        foregroundColor: context.colorScheme.error,\n   174→                      ),\n   175→                      child: const Text('Delete'),\n   176→                    ),\n   177→                  ],\n   178→                ),\n   179→              );\n   180→\n   181→              if (confirmed == true && context.mounted) {\n   182→                // Delete assignment\n   183→                final container = ProviderScope.containerOf(context);\n   184→                final teacherRepo = container.read(teacherRepositoryProvider);\n   185→                final result = await teacherRepo.deleteAssignment(assignment.id);\n   186→\n   187→                result.fold(\n   188→                  (failure) {\n   189→                    if (context.mounted) {\n   190→                      ScaffoldMessenger.of(context).showSnackBar(\n   191→                        SnackBar(content: Text('Error: ${failure.message}')),\n   192→                      );\n   193→                    }\n   194→                  },\n   195→                  (_) {\n   196→                    if (context.mounted) {\n   197→                      container.invalidate(teacherAssignmentsProvider);\n   198→                      container.invalidate(teacherStatsProvider);\n   199→                      ScaffoldMessenger.of(context).showSnackBar(\n   200→                        const SnackBar(content: Text('Assignment deleted')),\n   201→                      );\n   202→                      context.pop();\n   203→                    }\n   204→                  },\n   205→                );\n   206→              }\n   207→            }\n   208→          },\n   209→          itemBuilder: (context) => [\n   210→            const PopupMenuItem(\n   211→              value: 'delete',\n   212→              child: Row(\n   213→                children: [\n   214→                  Icon(Icons.delete, color: Colors.red),\n   215→                  SizedBox(width: 8),\n   216→                  Text('Delete', style: TextStyle(color: Colors.red)),\n   217→                ],\n   218→              ),\n   219→            ),\n   220→          ],\n   221→        ),\n   222→      ],\n   223→      flexibleSpace: FlexibleSpaceBar(\n   224→        background: Container(\n   225→          decoration: BoxDecoration(\n   226→            gradient: LinearGradient(\n   227→              colors: [\n   228→                _getTypeColor(assignment.type),\n   229→                _getTypeColor(assignment.type).withValues(alpha: 0.7),\n   230→              ],\n   231→              begin: Alignment.topCenter,\n   232→              end: Alignment.bottomCenter,\n   233→            ),\n   234→          ),\n   235→          child: SafeArea(\n   236→            child: Padding(\n   237→              padding: const EdgeInsets.all(16),\n   238→              child: Column(\n   239→                mainAxisAlignment: MainAxisAlignment.end,\n   240→                crossAxisAlignment: CrossAxisAlignment.start,\n   241→                children: [\n   242→                  // Type badge\n   243→                  Container(\n   244→                    padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n   245→                    decoration: BoxDecoration(\n   246→                      color: Colors.white.withValues(alpha: 0.2),\n   247→                      borderRadius: BorderRadius.circular(12),\n   248→                    ),\n   249→                    child: Row(\n   250→                      mainAxisSize: MainAxisSize.min,\n   251→                      children: [\n   252→                        Icon(\n   253→                          _getTypeIcon(assignment.type),\n   254→                          size: 14,\n   255→                          color: Colors.white,\n   256→                        ),\n   257→                        const SizedBox(width: 4),\n   258→                        Text(\n   259→                          assignment.type.displayName,\n   260→                          style: const TextStyle(\n   261→                            color: Colors.white,\n   262→                            fontSize: 12,\n   263→                            fontWeight: FontWeight.w500,\n   264→                          ),\n   265→                        ),\n   266→                      ],\n   267→                    ),\n   268→                  ),\n   269→                  const SizedBox(height: 8),\n   270→\n   271→                  // Title\n   272→                  Text(\n   273→                    assignment.title,\n   274→                    style: const TextStyle(\n   275→                      color: Colors.white,\n   276→                      fontSize: 22,\n   277→                      fontWeight: FontWeight.bold,\n   278→                    ),\n   279→                    maxLines: 2,\n   280→                    overflow: TextOverflow.ellipsis,\n   281→                  ),\n   282→\n   283→                  if (assignment.className != null) ...[\n   284→                    const SizedBox(height: 4),\n   285→                    Text(\n   286→                      assignment.className!,\n   287→                      style: TextStyle(\n   288→                        color: Colors.white.withValues(alpha: 0.8),\n   289→                        fontSize: 14,\n   290→                      ),\n   291→                    ),\n   292→                  ],\n   293→\n   294→                  const SizedBox(height: 8),\n   295→\n   296→                  // Due date\n   297→                  Row(\n   298→                    children: [\n   299→                      Icon(\n   300→                        Icons.calendar_today,\n   301→                        size: 14,\n   302→                        color: Colors.white.withValues(alpha: 0.8),\n   303→                      ),\n   304→                      const SizedBox(width: 4),\n   305→                      Text(\n   306→                        'Due: ${dateFormat.format(assignment.dueDate)}',\n   307→                        style: TextStyle(\n   308→                          color: Colors.white.withValues(alpha: 0.8),\n   309→                          fontSize: 13,\n   310→                        ),\n   311→                      ),\n   312→                      if (assignment.isOverdue) ...[\n   313→                        const SizedBox(width: 8),\n   314→                        Container(\n   315→                          padding: const EdgeInsets.symmetric(\n   316→                            horizontal: 6,\n   317→                            vertical: 2,\n   318→                          ),\n   319→                          decoration: BoxDecoration(\n   320→                            color: Colors.red,\n   321→                            borderRadius: BorderRadius.circular(8),\n   322→                          ),\n   323→                          child: const Text(\n   324→                            'OVERDUE',\n   325→                            style: TextStyle(\n   326→                              color: Colors.white,\n   327→                              fontSize: 10,\n   328→                              fontWeight: FontWeight.bold,\n   329→                            ),\n   330→                          ),\n   331→                        ),\n   332→                      ],\n   333→                    ],\n   334→                  ),\n   335→                ],\n   336→              ),\n   337→            ),\n   338→          ),\n   339→        ),\n   340→      ),\n   341→    );\n   342→  }\n   343→\n   344→  IconData _getTypeIcon(AssignmentType type) {\n   345→    switch (type) {\n   346→      case AssignmentType.book:\n   347→        return Icons.menu_book;\n   348→      case AssignmentType.vocabulary:\n   349→        return Icons.abc;\n   350→      case AssignmentType.mixed:\n   351→        return Icons.library_books;\n   352→    }\n   353→  }\n   354→\n   355→  Color _getTypeColor(AssignmentType type) {\n   356→    switch (type) {\n   357→      case AssignmentType.book:\n   358→        return Colors.blue;\n   359→      case AssignmentType.vocabulary:\n   360→        return Colors.purple;\n   361→      case AssignmentType.mixed:\n   362→        return Colors.teal;\n   363→    }\n   364→  }\n   365→}\n   366→\n   367→class _StatsBar extends StatelessWidget {\n   368→  const _StatsBar({required this.assignment});\n   369→\n   370→  final Assignment assignment;\n   371→\n   372→  @override\n   373→  Widget build(BuildContext context) {\n   374→    return Container(\n   375→      padding: const EdgeInsets.all(16),\n   376→      color: context.colorScheme.surfaceContainerHighest,\n   377→      child: Row(\n   378→        mainAxisAlignment: MainAxisAlignment.spaceAround,\n   379→        children: [\n   380→          _StatItem(\n   381→            value: '${assignment.totalStudents}',\n   382→            label: 'Students',\n   383→            icon: Icons.people,\n   384→            color: Colors.blue,\n   385→          ),\n   386→          _StatItem(\n   387→            value: '${assignment.completedStudents}',\n   388→            label: 'Completed',\n   389→            icon: Icons.check_circle,\n   390→            color: Colors.green,\n   391→          ),\n   392→          _StatItem(\n   393→            value: '${assignment.completionRate.toStringAsFixed(0)}%',\n   394→            label: 'Progress',\n   395→            icon: Icons.trending_up,\n   396→            color: Colors.orange,\n   397→          ),\n   398→        ],\n   399→      ),\n   400→    );\n   401→  }\n   402→}\n   403→\n   404→class _StatItem extends StatelessWidget {\n   405→  const _StatItem({\n   406→    required this.value,\n   407→    required this.label,\n   408→    required this.icon,\n   409→    required this.color,\n   410→  });\n   411→\n   412→  final String value;\n   413→  final String label;\n   414→  final IconData icon;\n   415→  final Color color;\n   416→\n   417→  @override\n   418→  Widget build(BuildContext context) {\n   419→    return Column(\n   420→      children: [\n   421→        Icon(icon, color: color, size: 24),\n   422→        const SizedBox(height: 4),\n   423→        Text(\n   424→          value,\n   425→          style: context.textTheme.titleMedium?.copyWith(\n   426→            fontWeight: FontWeight.bold,\n   427→          ),\n   428→        ),\n   429→        Text(\n   430→          label,\n   431→          style: context.textTheme.bodySmall?.copyWith(\n   432→            color: context.colorScheme.outline,\n   433→          ),\n   434→        ),\n   435→      ],\n   436→    );\n   437→  }\n   438→}\n   439→\n   440→class _StudentProgressCard extends StatelessWidget {\n   441→  const _StudentProgressCard({required this.student});\n   442→\n   443→  final AssignmentStudent student;\n   444→\n   445→  @override\n   446→  Widget build(BuildContext context) {\n   447→    return Card(\n   448→      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 4),\n   449→      child: Padding(\n   450→        padding: const EdgeInsets.all(12),\n   451→        child: Row(\n   452→          children: [\n   453→            // Avatar\n   454→            CircleAvatar(\n   455→              radius: 20,\n   456→              backgroundColor: context.colorScheme.primaryContainer,\n   457→              backgroundImage: student.avatarUrl != null\n   458→                  ? NetworkImage(student.avatarUrl!)\n   459→                  : null,\n   460→              child: student.avatarUrl == null\n   461→                  ? Text(\n   462→                      student.studentName.isNotEmpty\n   463→                          ? student.studentName[0].toUpperCase()\n   464→                          : '?',\n   465→                      style: TextStyle(\n   466→                        color: context.colorScheme.onPrimaryContainer,\n   467→                        fontWeight: FontWeight.bold,\n   468→                      ),\n   469→                    )\n   470→                  : null,\n   471→            ),\n   472→            const SizedBox(width: 12),\n   473→\n   474→            // Name and status\n   475→            Expanded(\n   476→              child: Column(\n   477→                crossAxisAlignment: CrossAxisAlignment.start,\n   478→                children: [\n   479→                  Text(\n   480→                    student.studentName,\n   481→                    style: context.textTheme.titleSmall?.copyWith(\n   482→                      fontWeight: FontWeight.w500,\n   483→                    ),\n   484→                  ),\n   485→                  const SizedBox(height: 4),\n   486→                  Row(\n   487→                    children: [\n   488→                      Icon(\n   489→                        _getStatusIcon(student.status),\n   490→                        size: 14,\n   491→                        color: _getStatusColor(student.status),\n   492→                      ),\n   493→                      const SizedBox(width: 4),\n   494→                      Text(\n   495→                        student.status.displayName,\n   496→                        style: context.textTheme.bodySmall?.copyWith(\n   497→                          color: _getStatusColor(student.status),\n   498→                        ),\n   499→                      ),\n   500→                    ],\n   501→                  ),\n   502→                ],\n   503→              ),\n   504→            ),\n   505→\n   506→            // Progress\n   507→            SizedBox(\n   508→              width: 50,\n   509→              height: 50,\n   510→              child: Stack(\n   511→                alignment: Alignment.center,\n   512→                children: [\n   513→                  CircularProgressIndicator(\n   514→                    value: student.progress / 100,\n   515→                    strokeWidth: 4,\n   516→                    backgroundColor: context.colorScheme.surfaceContainerHighest,\n   517→                    color: _getStatusColor(student.status),\n   518→                  ),\n   519→                  Text(\n   520→                    '${student.progress.toStringAsFixed(0)}%',\n   521→                    style: context.textTheme.labelSmall?.copyWith(\n   522→                      fontWeight: FontWeight.bold,\n   523→                    ),\n   524→                  ),\n   525→                ],\n   526→              ),\n   527→            ),\n   528→\n   529→            // Score (if completed)\n   530→            if (student.score != null) ...[\n   531→              const SizedBox(width: 12),\n   532→              Container(\n   533→                padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n   534→                decoration: BoxDecoration(\n   535→                  color: _getScoreColor(student.score!).withValues(alpha: 0.1),\n   536→                  borderRadius: BorderRadius.circular(8),\n   537→                ),\n   538→                child: Text(\n   539→                  '${student.score!.toStringAsFixed(0)}%',\n   540→                  style: context.textTheme.labelMedium?.copyWith(\n   541→                    color: _getScoreColor(student.score!),\n   542→                    fontWeight: FontWeight.bold,\n   543→                  ),\n   544→                ),\n   545→              ),\n   546→            ],\n   547→          