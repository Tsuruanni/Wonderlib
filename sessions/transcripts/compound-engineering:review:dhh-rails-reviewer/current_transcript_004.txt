530→```bash\n   531→curl -X POST \"https://xxx.supabase.co/functions/v1/generate-audio-sync\" \\\n   532→  -H \"Authorization: Bearer xxx\" \\\n   533→  -d '{\"blockId\": \"xxx\", \"text\": \"Hello world\", \"voice\": \"Vivian\"}'\n   534→# audioUrl ve wordTimings dönmeli\n   535→```\n   536→\n   537→---\n   538→\n   539→## Açık Kararlar (Sonradan)\n   540→\n   541→1. **Forced Alignment Servisi**: WhisperX self-hosted mi, API mı? (Replicate.com'da var)\n   542→2. **Offline Cache**: Audio dosyaları local'e cache edilecek mi?\n   543→3. **Admin UI**: TTS generate butonu nerede? (Teacher dashboard, ayrı admin panel?)\n   544→4. **Türkçe TTS**: Fal AI Türkçe destekliyor mu? (Test edilmeli)\n   545→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"
      }
    ]
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "thinking",
        "thinking": "The plan is complete and comprehensive. It includes:\n1. Current state analysis\n2. User decisions captured\n3. ContentBlock architecture with entity, database schema\n4. Fal AI TTS + Forced Alignment pipeline\n5. Flutter widget architecture with code examples\n6. Detailed implementation steps (7 steps)\n7. File summary (17 new files, 4 modified files)\n8. Verification plan (static analysis, migration, unit tests, manual tests, edge function)\n9. Open decisions for later\n\nThe plan is ready for user approval. I should call ExitPlanMode now.",
        "signature": "ErsFCkYICxgCKkB1fuo+E1Q8jIr+/Dd31GWvHpEuVJDvH1D7ASzq4zCGneJfML4I8r7K1ljPbBESQlD6T8xSCKaRsx+BP4W7mUDWEgxSeCwV0aQ9RTON+LgaDIMF5m+2kJcQ2hDOzSIwwjSrcE+Y6AHRRre2+QET2JDjnvAIuWccQQeqLnX+4kX9cLMag/MVW3eA122AT+oRKqIEQZTV2zSPdErb+QhtvkMB8nrAtBRcXDM2ew57oUfrw5uvUufUoljotsJ1cKy3JhL3Hv0QyCydtfD7qdKG+uni9KX1hb4vMJUjs2g3bPkljStxdm/fzd+8EmgXoo+NU14HSA0rjoCAUX/JbFJH+NS/2erGEZQScZFG/s0TwR3dFMdQCAnZyV4cwf9gN8UGcd4wIrLTasbTi+8rXvRIoBHh3ZMGd6Sl+vM1ySR50mOhHmxfvcMLKbSD69mfCTbpiHlP/0NR/ePzJDcs2hns5HOxY2omzuFAIX8+jnaPQv9UNjy8ZxiUG3f8Ux/quMdR7bwUszIAYO4E7myHcACRr7eRKhnPufEG8JjVm6ZMJxfqcjYTkHgX7b/QKpfLMUEdBis2111QzhJMvkEdW/HncJZT57nEKwWBHXbRo233jnEgau5jQHIm8MnuXTIVsJqdSKSkrv4JouhmY+EzWrYS9+c+2FYFzTxhgDJAC3F5okWobfXIIEHyyfuBDF6mCNkB4O0hVgBBFUSBcGRr3ddGBt5Y2WbWi6yGNcSrNkYFzSm8JXH9M7eLygC/rl45j8Iskod4pvFTnFE1ggCBvW9ft7bwhHfc4O+i8msR7cOGkL6ZZsFWdRKN4znJ2XBVevdjffhPE6N4W0iSVq3ox2TA5q1USVOtRlgvoTCLVlHfNEgBtLfgHBUy2k0KBiCx8m40GMQKD7lMasWkxuac1f+1rgipo1NCGAE="
      }
    ]
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Plan tamamlandı. Özet:\n\n## Plan Özeti\n\n**Kapsam**: Kelime-seviye karaoke tarzı sesli okuma sistemi\n\n**Mimari Kararlar**:\n- `ContentBlock` entity ile restructure (paragraflar ayrı row)\n- Fal AI TTS + WhisperX forced alignment pipeline\n- `WordTiming` ile kelime-seviye timestamp\n\n**Dosya Sayısı**:\n- 17 yeni dosya (entity, model, repository, provider, widget, edge function)\n- 4 değiştirilecek dosya\n\n**7 Adımlı Uygulama**:\n1. Database & Migration\n2. Domain Layer (entity, repository, usecase)\n3. Data Layer (model, repository impl)\n4. Providers (contentBlocks, audioSync)\n5. Widgets (ContentBlockList, TextBlockWidget, WordHighlightText, AudioPlayerControls)\n6. ReaderScreen entegrasyonu\n7. Edge Function (TTS + alignment)"
      }
    ]
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool_use",
        "id": "toolu_01UuN3KtanNBG3TDnT1fDVVQ",
        "name": "ExitPlanMode",
        "input": {
          "plan": "# Senkronize Sesli Okuma ve Highlight Sistemi\n\n## Özet\nReader ekranlarına paragraf bazlı sesli okuma ve **kelime-seviye metin senkronizasyonu** eklenmesi. Ses çalarken her kelime sırayla highlight edilecek (karaoke tarzı).\n\n## Kullanıcı Kararları\n- **Audio Kaynağı**: Fal AI (Qwen-3 TTS) + Forced Alignment\n- **Highlight Seviyesi**: Kelime seviyesi (karaoke)\n- **Veri Yapısı**: ContentBlock entity oluşturulacak (restructure)\n- **Scope**: Faz 1 + 2 birlikte (MVP + auto-scroll + word highlight)\n\n---\n\n## Mevcut Durum Analizi\n\n### Reader Sistemi\n- `ReaderScreen` → Ana container (Riverpod)\n- `IntegratedReaderContent` → Aktivite-gated içerik orchestration\n- `ParagraphWidget` → Vocabulary highlight desteği ile paragraf render\n- Content: Plain text, `\\n\\n` ile paragraf ayrımı\n- Vocabulary: `startIndex/endIndex` karakter pozisyonları ile highlight\n\n### Audio Altyapısı (HAZIR)\n- `AudioService` → `just_audio` ile tam implementasyon\n- `Chapter.audioUrl` → Mevcut ama UI'da kullanılmıyor\n- Cloudflare R2 → Media storage hazır\n\n### Kritik Dosyalar\n```\nlib/presentation/screens/reader/reader_screen.dart          # Ana reader\nlib/presentation/widgets/reader/paragraph_widget.dart       # Paragraf render\nlib/presentation/widgets/reader/integrated_reader_content.dart  # İçerik orchestration\nlib/presentation/providers/reader_provider.dart             # State management\nlib/core/services/audio_service.dart                        # Audio playback\nlib/domain/entities/chapter.dart                            # Chapter entity\n```\n\n---\n\n## Önerilen Mimari\n\n### 1. Data Model: AudioSyncData (Yeni Entity)\n\n```dart\n/// Senkronizasyon granülaritesi\nenum SyncGranularity { paragraph, sentence, word }\n\n/// Chapter için audio timing verisi\nclass AudioSyncData {\n  final String id;\n  final String chapterId;\n  final String audioUrl;\n  final Duration duration;\n  final SyncGranularity granularity;\n  final List<AudioSegment> segments;\n  final String? source; // 'manual', 'tts', 'forced_alignment'\n}\n\n/// Zamanlı metin segmenti\nclass AudioSegment {\n  final String text;\n  final Duration startTime;\n  final Duration endTime;\n  final int startIndex;  // Content içindeki karakter pozisyonu\n  final int endIndex;\n  final int? paragraphIndex;\n  final int? sentenceIndex;\n}\n```\n\n### 2. Database Schema\n\n```sql\nCREATE TABLE audio_sync_data (\n    id UUID PRIMARY KEY,\n    chapter_id UUID REFERENCES chapters(id) ON DELETE CASCADE,\n    audio_url VARCHAR(500) NOT NULL,\n    duration_ms INTEGER NOT NULL,\n    granularity VARCHAR(20) CHECK (granularity IN ('paragraph', 'sentence', 'word')),\n    segments JSONB NOT NULL,  -- [{text, startMs, endMs, startIndex, endIndex, ...}]\n    source VARCHAR(50),\n    created_at TIMESTAMPTZ DEFAULT NOW()\n);\n```\n\n### 3. Timing Data Format (JSON)\n\n```json\n{\n  \"segments\": [\n    {\n      \"text\": \"Once upon a time, there lived a merchant.\",\n      \"startMs\": 0,\n      \"endMs\": 2500,\n      \"startIndex\": 0,\n      \"endIndex\": 42,\n      \"paragraphIndex\": 0,\n      \"sentenceIndex\": 0\n    }\n  ]\n}\n```\n\n### 4. Flutter Widget Mimarisi\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                      ReaderScreen                           │\n│  ┌──────────────────────────────────────────────────────┐  │\n│  │              AudioPlayerControls (Floating)           │  │\n│  │  [◀◀] [▶/⏸] [▶▶] ━━━━●━━━━━━━ 01:23/05:45  [1.0x]   │  │\n│  └──────────────────────────────────────────────────────┘  │\n│                                                             │\n│  ┌──────────────────────────────────────────────────────┐  │\n│  │           ContentBlockList (yeni widget)              │  │\n│  │  ┌────────────────────────────────────────────────┐  │  │\n│  │  │  TextBlockWidget (type: text)                  │  │  │\n│  │  │  \"Once upon a [TIME] there lived...\"           │  │  │\n│  │  │                   ↑                            │  │  │\n│  │  │           [HIGHLIGHTED WORD]                   │  │  │\n│  │  └────────────────────────────────────────────────┘  │  │\n│  │  ┌────────────────────────────────────────────────┐  │  │\n│  │  │  ImageBlockWidget (type: image)                │  │  │\n│  │  │  [═══════════ IMAGE ═══════════]               │  │  │\n│  │  │  \"A castle on the hill\"                        │  │  │\n│  │  └────────────────────────────────────────────────┘  │  │\n│  │  ┌────────────────────────────────────────────────┐  │  │\n│  │  │  ActivityBlockWidget (type: activity)          │  │  │\n│  │  │  [True/False Question]                         │  │  │\n│  │  └────────────────────────────────────────────────┘  │  │\n│  └──────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────┘\n```\n\n### Word-Level Highlight Widget\n\n```dart\nclass WordHighlightText extends StatelessWidget {\n  final String text;\n  final List<WordTiming> wordTimings;\n  final int? activeWordIndex;  // Provider'dan gelir\n  final ReaderSettings settings;\n\n  @override\n  Widget build(BuildContext context) {\n    return RichText(\n      text: TextSpan(\n        children: _buildWordSpans(),\n      ),\n    );\n  }\n\n  List<InlineSpan> _buildWordSpans() {\n    final spans = <InlineSpan>[];\n    int currentIndex = 0;\n\n    for (int i = 0; i < wordTimings.length; i++) {\n      final timing = wordTimings[i];\n\n      // Kelime öncesi boşluk/punctuation\n      if (timing.startIndex > currentIndex) {\n        spans.add(TextSpan(\n          text: text.substring(currentIndex, timing.startIndex),\n          style: _normalStyle,\n        ));\n      }\n\n      // Kelime (highlight edilmiş veya normal)\n      final isActive = i == activeWordIndex;\n      spans.add(TextSpan(\n        text: timing.word,\n        style: isActive ? _highlightStyle : _normalStyle,\n      ));\n\n      currentIndex = timing.endIndex;\n    }\n\n    // Kalan metin\n    if (currentIndex < text.length) {\n      spans.add(TextSpan(text: text.substring(currentIndex)));\n    }\n\n    return spans;\n  }\n\n  TextStyle get _highlightStyle => TextStyle(\n    backgroundColor: Colors.yellow.withOpacity(0.5),\n    fontWeight: FontWeight.bold,\n  );\n}\n```\n\n### 5. Audio Sync Provider\n\n```dart\nclass AudioSyncController extends StateNotifier<AudioSyncState> {\n  // Audio position stream dinle\n  // Binary search ile aktif segment bul\n  // State güncelle → UI highlight değişir\n\n  void _onPositionChanged(Duration position) {\n    final activeIndex = _findActiveSegment(segments, position);\n    state = state.copyWith(activeSegmentIndex: activeIndex);\n  }\n}\n```\n\n---\n\n## ContentBlock Mimarisi (SEÇİLDİ)\n\nMevcut `Chapter.content` (plain text) yapısından **explicit ContentBlock** yapısına geçiş.\n\n### Yeni Entity: ContentBlock\n\n```dart\nenum ContentBlockType {\n  text,      // Paragraf metni\n  image,     // Görsel\n  audio,     // Standalone ses (podcast tarzı)\n  activity,  // Inline aktivite referansı\n}\n\nclass ContentBlock {\n  final String id;\n  final String chapterId;\n  final int orderIndex;\n  final ContentBlockType type;\n\n  // Text block için\n  final String? text;\n  final List<WordTiming>? wordTimings;  // Kelime-seviye sync\n  final String? audioUrl;               // Bu blok için ses\n\n  // Image block için\n  final String? imageUrl;\n  final String? caption;\n\n  // Activity block için\n  final String? activityId;\n}\n\nclass WordTiming {\n  final String word;\n  final int startIndex;      // Metin içi karakter pozisyonu\n  final int endIndex;\n  final int startMs;         // Audio başlangıç (milisaniye)\n  final int endMs;           // Audio bitiş\n}\n```\n\n### Database Schema: content_blocks\n\n```sql\nCREATE TABLE content_blocks (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    chapter_id UUID NOT NULL REFERENCES chapters(id) ON DELETE CASCADE,\n    order_index INTEGER NOT NULL,\n    type VARCHAR(20) NOT NULL CHECK (type IN ('text', 'image', 'audio', 'activity')),\n\n    -- Text block\n    text TEXT,\n    audio_url VARCHAR(500),\n    word_timings JSONB,  -- [{word, startIndex, endIndex, startMs, endMs}]\n\n    -- Image block\n    image_url VARCHAR(500),\n    caption TEXT,\n\n    -- Activity block\n    activity_id UUID REFERENCES inline_activities(id),\n\n    created_at TIMESTAMPTZ DEFAULT NOW(),\n    updated_at TIMESTAMPTZ DEFAULT NOW(),\n\n    UNIQUE(chapter_id, order_index)\n);\n\nCREATE INDEX idx_content_blocks_chapter ON content_blocks(chapter_id);\n```\n\n### Migration Stratejisi\n\n```\nMevcut: chapters.content (plain text \"\\n\\n\" separated)\n        ↓\nYeni:   content_blocks tablosu (her paragraf ayrı row)\n```\n\n1. Mevcut chapter'ları parse et\n2. Her paragraf için `content_blocks` row oluştur\n3. `chapters.content` → deprecated (nullable yap)\n4. Yeni content ekleme artık `content_blocks` üzerinden\n\n---\n\n## Audio Pipeline: Fal AI + Forced Alignment\n\n### Fal AI Qwen-3 TTS Özellikleri\n- **Endpoint**: `fal-ai/qwen-3-tts/text-to-speech/1.7b`\n- **Voices**: Vivian, Serena, Dylan, Eric, Ryan, Aiden, vs.\n- **Languages**: Auto, English, Turkish?, Chinese, Spanish, French...\n- **Output**: MP3, 24kHz, mono\n- **⚠️ SINIR**: Timestamp vermiyor, sadece toplam duration\n\n### Gerekli Pipeline\n\n```\n┌─────────────┐     ┌─────────────┐     ┌─────────────────┐\n│ ContentBlock│────▶│  Fal AI     │────▶│  Audio File     │\n│   (text)    │     │  TTS API    │     │  (.mp3)         │\n└─────────────┘     └─────────────┘     └─────────────────┘\n       │                                        │\n       │                                        ▼\n       │            ┌─────────────────┐  ┌─────────────────┐\n       └───────────▶│ Forced Aligner  │◀─│  Text + Audio   │\n                    │ (WhisperX/Aeneas)│  │                 │\n                    └─────────────────┘  └─────────────────┘\n                            │\n                            ▼\n                    ┌─────────────────┐\n                    │  Word Timings   │\n                    │  (JSON)         │\n                    └─────────────────┘\n```\n\n### Forced Alignment Seçenekleri\n\n| Tool | Pros | Cons |\n|------|------|------|\n| **WhisperX** | En doğru, kelime-seviye, çok dilli | GPU gerektirir, yavaş |\n| **Aeneas** | Hızlı, lightweight | Cümle-seviye (kelime için hack gerekir) |\n| **Gentle** | Kelime-seviye, iyi doğruluk | Self-hosted, sadece İngilizce |\n\n**Önerilen**: WhisperX (Edge Function veya external service olarak)\n\n### Edge Function: generate-audio-sync\n\n```typescript\n// supabase/functions/generate-audio-sync/index.ts\nDeno.serve(async (req) => {\n  const { blockId, text, voice } = await req.json();\n\n  // 1. Fal AI TTS çağır\n  const audioResult = await fal.subscribe(\"fal-ai/qwen-3-tts/text-to-speech/1.7b\", {\n    input: { text, voice }\n  });\n\n  // 2. Audio'yu R2'ye yükle\n  const audioUrl = await uploadToR2(audioResult.url, blockId);\n\n  // 3. WhisperX ile forced alignment (external API veya self-hosted)\n  const wordTimings = await runForcedAlignment(text, audioUrl);\n\n  // 4. content_blocks tablosunu güncelle\n  await supabase.from('content_blocks').update({\n    audio_url: audioUrl,\n    word_timings: wordTimings\n  }).eq('id', blockId);\n\n  return Response.json({ success: true, audioUrl, wordTimings });\n});\n```\n\n---\n\n## Uygulama Planı (Faz 1 + 2 Birleşik)\n\n### Adım 1: Database & Migration\n- [ ] `content_blocks` tablosu oluştur\n- [ ] Mevcut `chapters.content` → `content_blocks` migration scripti\n- [ ] `chapters.content` nullable yap (backward compat)\n\n**Dosyalar:**\n```\nsupabase/migrations/YYYYMMDD_content_blocks.sql\nsupabase/migrations/YYYYMMDD_migrate_content_to_blocks.sql\n```\n\n### Adım 2: Domain Layer\n- [ ] `ContentBlock` entity\n- [ ] `WordTiming` value object\n- [ ] `ContentBlockRepository` interface\n- [ ] `GetContentBlocksUseCase`\n- [ ] `UpdateContentBlockAudioUseCase`\n\n**Dosyalar:**\n```\nlib/domain/entities/content_block.dart\nlib/domain/entities/word_timing.dart\nlib/domain/repositories/content_block_repository.dart\nlib/domain/usecases/content/get_content_blocks_usecase.dart\nlib/domain/usecases/content/update_content_block_audio_usecase.dart\n```\n\n### Adım 3: Data Layer\n- [ ] `ContentBlockModel` (JSON serialization)\n- [ ] `WordTimingModel`\n- [ ] `SupabaseContentBlockRepository`\n\n**Dosyalar:**\n```\nlib/data/models/content/content_block_model.dart\nlib/data/models/content/word_timing_model.dart\nlib/data/repositories/supabase/supabase_content_block_repository.dart\n```\n\n### Adım 4: Presentation Layer - Providers\n- [ ] `contentBlocksProvider` (chapter için blokları getir)\n- [ ] `audioSyncProvider` (playback state + aktif kelime index)\n- [ ] `AudioSyncController` (play/pause/seek/speed)\n\n**Dosyalar:**\n```\nlib/presentation/providers/content_block_provider.dart\nlib/presentation/providers/audio_sync_provider.dart\n```\n\n### Adım 5: Presentation Layer - Widgets\n- [ ] `ContentBlockList` (blokları listele)\n- [ ] `TextBlockWidget` (metin + kelime highlight)\n- [ ] `ImageBlockWidget` (görsel + caption)\n- [ ] `ActivityBlockWidget` (inline aktivite wrapper)\n- [ ] `WordHighlightText` (karaoke tarzı highlight)\n- [ ] `AudioPlayerControls` (floating player)\n\n**Dosyalar:**\n```\nlib/presentation/widgets/reader/content_block_list.dart\nlib/presentation/widgets/reader/text_block_widget.dart\nlib/presentation/widgets/reader/image_block_widget.dart\nlib/presentation/widgets/reader/activity_block_widget.dart\nlib/presentation/widgets/reader/word_highlight_text.dart\nlib/presentation/widgets/reader/audio_player_controls.dart\n```\n\n### Adım 6: ReaderScreen Entegrasyonu\n- [ ] `IntegratedReaderContent` → `ContentBlockList` ile değiştir\n- [ ] `AudioPlayerControls` ekle (floating bottom)\n- [ ] Auto-scroll implementasyonu\n\n**Dosyalar (Modify):**\n```\nlib/presentation/screens/reader/reader_screen.dart\n```\n\n### Adım 7: Audio Generation Pipeline (Edge Function)\n- [ ] Fal AI TTS entegrasyonu\n- [ ] R2 upload helper\n- [ ] WhisperX forced alignment (external service)\n- [ ] `generate-audio-sync` Edge Function\n\n**Dosyalar:**\n```\nsupabase/functions/generate-audio-sync/index.ts\nlib/core/services/fal_ai_service.dart (optional - if calling from app)\n```\n\n---\n\n## Dosya Özeti\n\n### Yeni Dosyalar (17 dosya)\n\n| Katman | Dosya |\n|--------|-------|\n| DB | `supabase/migrations/YYYYMMDD_content_blocks.sql` |\n| DB | `supabase/migrations/YYYYMMDD_migrate_content.sql` |\n| Domain | `lib/domain/entities/content_block.dart` |\n| Domain | `lib/domain/entities/word_timing.dart` |\n| Domain | `lib/domain/repositories/content_block_repository.dart` |\n| Domain | `lib/domain/usecases/content/get_content_blocks_usecase.dart` |\n| Domain | `lib/domain/usecases/content/update_content_block_audio_usecase.dart` |\n| Data | `lib/data/models/content/content_block_model.dart` |\n| Data | `lib/data/models/content/word_timing_model.dart` |\n| Data | `lib/data/repositories/supabase/supabase_content_block_repository.dart` |\n| Provider | `lib/presentation/providers/content_block_provider.dart` |\n| Provider | `lib/presentation/providers/audio_sync_provider.dart` |\n| Widget | `lib/presentation/widgets/reader/content_block_list.dart` |\n| Widget | `lib/presentation/widgets/reader/text_block_widget.dart` |\n| Widget | `lib/presentation/widgets/reader/word_highlight_text.dart` |\n| Widget | `lib/presentation/widgets/reader/audio_player_controls.dart` |\n| Edge Fn | `supabase/functions/generate-audio-sync/index.ts` |\n\n### Değiştirilecek Dosyalar (4 dosya)\n\n| Dosya | Değişiklik |\n|-------|------------|\n| `lib/presentation/screens/reader/reader_screen.dart` | ContentBlockList + AudioPlayerControls |\n| `lib/presentation/providers/repository_providers.dart` | ContentBlockRepository provider ekle |\n| `lib/presentation/providers/usecase_providers.dart` | UseCase provider'lar ekle |\n| `lib/domain/entities/chapter.dart` | `content` → deprecated, `hasContentBlocks` getter |\n\n---\n\n## Verification Plan\n\n### 1. Statik Analiz\n```bash\ndart analyze lib/\n# Hata: 0\n```\n\n### 2. Migration Test\n```bash\nsupabase db reset\n# content_blocks tablosu oluşmalı\n# Mevcut chapter content migrate olmalı\n```\n\n### 3. Unit Tests\n```bash\nflutter test test/unit/domain/entities/content_block_test.dart\nflutter test test/unit/data/models/content_block_model_test.dart\n```\n\n### 4. Manual Test Senaryoları\n\n| Senaryo | Beklenen |\n|---------|----------|\n| Chapter aç (audio var) | AudioPlayerControls görünür |\n| Play'e bas | Audio çalar, kelimeler sırayla highlight |\n| Pause | Audio durur, highlight son kelimede kalır |\n| Speed 1.5x | Hızlı çalar, highlight senkron kalır |\n| Kelimeye tıkla | O noktaya seek eder |\n| Scroll down (audio çalarken) | Auto-scroll aktif kelimeye döner |\n| Chapter aç (audio yok) | AudioPlayerControls gizli |\n\n### 5. Edge Function Test\n```bash\ncurl -X POST \"https://xxx.supabase.co/functions/v1/generate-audio-sync\" \\\n  -H \"Authorization: Bearer xxx\" \\\n  -d '{\"blockId\": \"xxx\", \"text\": \"Hello world\", \"voice\": \"Vivian\"}'\n# audioUrl ve wordTimings dönmeli\n```\n\n---\n\n## Açık Kararlar (Sonradan)\n\n1. **Forced Alignment Servisi**: WhisperX self-hosted mi, API mı? (Replicate.com'da var)\n2. **Offline Cache**: Audio dosyaları local'e cache edilecek mi?\n3. **Admin UI**: TTS generate butonu nerede? (Teacher dashboard, ayrı admin panel?)\n4. **Türkçe TTS**: Fal AI Türkçe destekliyor mu? (Test edilmeli)\n"
        },
        "caller": {
          "type": "direct"
        }
      }
    ]
  },
  {
    "role": "user",
    "content": [
      {
        "type": "tool_result",
